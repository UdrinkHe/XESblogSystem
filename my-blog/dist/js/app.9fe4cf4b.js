(function(){"use strict";var t={7645:function(t,e,s){s(4114);var i=s(6848),a=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("div",{staticClass:"bgContainer"}),t.showNavigation?e("topNavigation"):t._e(),e("div",{staticClass:"mainContainer mt10"},[t.hasUserInfo||t.toAuth?e("router-view"):t._e()],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isBgBlack,expression:"isBgBlack"}],staticClass:"black-bg"})],1)},o=[],n=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"topNavigation"}},[e("div",[t._m(0),e("div",{staticClass:"searchBlock"},[e("el-input",{attrs:{placeholder:"搜点什么吧.."},on:{input:function(e){return t.changingSearchForResult()}},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}}),e("el-button",[t._v("搜索")])],1),e("div",{staticClass:"rightFucBlock"},[e("div",{staticClass:"userProfileBlock"},[e("div",{staticClass:"userProfile"},[e("img",{attrs:{src:t.profileUrl}})]),e("div",{staticClass:"userFucList"},[e("div",{staticClass:"baseInfo"},[e("div",[t._v(t._s(this.username))]),e("hr"),t._m(1)]),e("div",{staticClass:"mainFuc"},[e("div",{on:{click:function(e){return t.routerPushTo("/personalCenter/baseInfo")}}},[e("i",{staticClass:"el-icon-user"}),t._v(" 个人信息 ")]),t._m(2),e("div",{on:{click:t.logoutOpen}},[e("i",{staticClass:"el-icon-switch-button"}),t._v(" 退出登录 ")])])])]),e("div",{on:{click:function(e){return t.routerPushTo("/messageCenter")}}},[t._v(" 消息 "),t._m(3)]),e("div",[t._v("历史")]),e("div",{on:{click:function(e){return t.routerPushTo("/myToolCenter")}}},[t._v(" 工具列表 "),e("div",{staticClass:"fucList"},[e("div"),e("div",{on:{click:function(e){return e.stopPropagation(),t.routerPushTo("/scheduleBlock/mySchedule")}}},[t._v("日程表")])])]),e("div",{on:{click:function(e){return t.routerPushTo("/editorBlock/creationManagement")}}},[t._v("创作中心")]),e("div",[e("el-button",{on:{click:function(e){return t.routerPushTo("/editorPage")}}},[e("i",{staticClass:"el-icon-edit"}),t._v(" 发布 ")])],1)])])])},r=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"leftFucBlock"},[e("div",[t._v("文章")]),e("div",[t._v("问答")]),e("div",[t._v("话题广场")]),e("div")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"baseSinple flex-display"},[e("div",[e("div",[t._v("粉丝")]),e("div",[t._v("100000")])]),e("div",[e("div",[t._v("关注")]),e("div",[t._v("100")])]),e("div",[e("div",[t._v("获赞")]),e("div",[t._v("100")])])])},function(){var t=this,e=t._self._c;return e("div",[e("i",{staticClass:"el-icon-setting"}),t._v(" 设置 ")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"fucList"},[e("div"),e("div",[t._v("评论和@")]),e("div",[t._v("新增粉丝")]),e("div",[t._v("赞和收藏")]),e("div",[t._v("私信")])])}],l=s(3518),c={name:"topNavigation",components:{},data(){return{searchValue:"",messageCenter:""}},computed:{...(0,l.L8)("auth",["profileUrl","username"])},methods:{routerPushTo(t){if(this.$route.path!==t){if("/editorPage"===t){let e=this.$router.resolve({path:t,query:{articleId:"new"}});return void window.open(e.href,"_blank")}this.$router.push(t)}},logoutOpen(){this.$confirm("确定要退出登录吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{await this.$store.dispatch("auth/logout"),this.$router.push("/auth")})).catch((()=>{this.$message.info("已取消退出登录")}))}}},d=c,u=s(1656),h=(0,u.A)(d,n,r,!1,null,"de15bf30",null),p=h.exports,m={name:"App",components:{topNavigation:p},computed:{showNavigation(){return"/auth"!==this.$route.path},toAuth(){return"/auth"===this.$route.path},hasUserInfo(){return this.$store.getters["auth/user"]},...(0,l.aH)("pageStatus",["isBgBlack"])},methods:{async getUserInfo(){console.log("入口"),console.log(this.$store.getters["auth/isAuthenticated"]),console.log(this.$store.getters["auth/user"]),this.$store.getters["auth/isAuthenticated"]&&!this.$store.getters["auth/user"]&&(console.log("没有用户信息，我去获取一个"),await this.$store.dispatch("auth/fetchUser"))}},created(){this.getUserInfo()}},g=m,f=(0,u.A)(g,a,o,!1,null,null,null),v=f.exports,C=s(6178),_=function(){var t=this,e=t._self._c;return e("div",{staticClass:"auth-page"},[e("div",{staticClass:"auth-container"},[e("h1",{staticClass:"auth-title"},[t._v("欢迎")]),e("el-tabs",{staticClass:"custom-tabs",model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[e("el-tab-pane",{attrs:{label:"登录",name:"login"}},[e("login-form")],1),e("el-tab-pane",{attrs:{label:"注册",name:"register"}},[e("register-form",{on:{registerSuccess:t.turnToLogin}})],1)],1)],1)])},y=[],I=function(){var t=this,e=t._self._c;return e("el-form",{ref:"loginForm",attrs:{model:t.loginForm,rules:t.loginRules}},[e("el-form-item",{attrs:{prop:"username"}},[e("el-input",{attrs:{placeholder:"用户名"},model:{value:t.loginForm.username,callback:function(e){t.$set(t.loginForm,"username",e)},expression:"loginForm.username"}})],1),e("el-form-item",{attrs:{prop:"password"}},[e("el-input",{attrs:{type:"password",placeholder:"密码"},model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("loginForm")}}},[t._v("登录")])],1)],1)},w=[],S={name:"LoginForm",data(){return{loginForm:{username:"",password:""},loginRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}}},methods:{...(0,l.i0)("auth",["login"]),submitForm(t){this.$refs[t].validate((t=>{if(!t)return this.$message.error("表单验证失败"),!1;this.login(this.loginForm).then((t=>{t?(this.$message({message:"登录成功",type:"success"}),this.$router.push("/scheduleBlock/mySchedule")):this.$message.error("登录失败，请检查用户名和密码")}))}))}}},k=S,b=(0,u.A)(k,I,w,!1,null,null,null),x=b.exports,T=function(){var t=this,e=t._self._c;return e("el-form",{ref:"registerForm",attrs:{model:t.registerForm,rules:t.registerRules}},[e("el-form-item",{attrs:{prop:"username"}},[e("el-input",{attrs:{placeholder:"用户名"},model:{value:t.registerForm.username,callback:function(e){t.$set(t.registerForm,"username",e)},expression:"registerForm.username"}})],1),e("el-form-item",{attrs:{prop:"password"}},[e("el-input",{attrs:{type:"password",placeholder:"密码"},model:{value:t.registerForm.password,callback:function(e){t.$set(t.registerForm,"password",e)},expression:"registerForm.password"}})],1),e("el-form-item",{attrs:{prop:"email"}},[e("el-input",{attrs:{placeholder:"邮箱"},model:{value:t.registerForm.email,callback:function(e){t.$set(t.registerForm,"email",e)},expression:"registerForm.email"}})],1),e("el-form-item",{attrs:{prop:"verificationCode"}},[e("el-input",{attrs:{placeholder:"验证码"},model:{value:t.registerForm.verificationCode,callback:function(e){t.$set(t.registerForm,"verificationCode",e)},expression:"registerForm.verificationCode"}},[e("el-button",{attrs:{slot:"append",disabled:t.cooldown>0},on:{click:t.sendVerificationCode},slot:"append"},[t._v(" "+t._s(t.cooldown>0?`${t.cooldown}秒后重试`:"发送验证码")+" ")])],1)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.toRegister()}}},[t._v("注册")])],1)],1)},$=[],F={name:"RegisterForm",data(){return{registerForm:{username:"",password:"",email:"",verificationCode:""},registerRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],verificationCode:[{required:!0,message:"请输入验证码",trigger:"blur"}]},cooldown:0}},methods:{sendVerificationCode(){this.$axios.post("api/user/auth/send-verification-code",{email:this.registerForm.email}).then((()=>{this.$message({message:`发送验证码到 ${this.registerForm.email}`,type:"info"}),this.cooldown=60;const t=setInterval((()=>{this.cooldown--,this.cooldown<=0&&clearInterval(t)}),1e3)})).catch((()=>{this.$message.error("发送验证码失败")}))},toRegister(){if(""===this.registerForm.username||""===this.registerForm.password||""===this.registerForm.email||""===this.registerForm.verificationCode)return void this.$message.error("表单数据不能为空");const{username:t,password:e,email:s,verificationCode:i}=this.registerForm;this.$axios.post("api/user/auth/register",{username:t,password:e,email:s,code:i}).then((()=>{this.$message.success("注册成功"),this.$emit("registerSuccess")})).catch((()=>{this.$message.error("注册失败")}))}}},A=F,D=(0,u.A)(A,T,$,!1,null,null,null),L=D.exports,E={name:"AuthPage",components:{LoginForm:x,RegisterForm:L},data(){return{activeTab:"login"}},methods:{turnToLogin(){this.activeTab="login"}}},B=E,P=(0,u.A)(B,_,y,!1,null,"795cb722",null),O=P.exports,M=function(){var t=this,e=t._self._c;return e("div",{staticClass:"flex-display",attrs:{id:"scheduleBlock"}},[e("div",{staticClass:"editorNav"},[e("myLeftNav",{attrs:{navData:t.navData}})],1),e("div",{staticClass:"ml20"},[e("router-view",{attrs:{name:"scheduleMain"}})],1)])},N=[],z=function(){var t=this,e=t._self._c;return e("div",{staticClass:"myLeftNav"},[t._t("navContent",(function(){return[t._l(t.navData,(function(s,i){return[e("div",{key:s.name,class:{isChoose:t.listStatus[i]},on:{click:function(e){return t.routerPushTo(i,s.path)}}},[t._v(" "+t._s(s.name)+" ")])]}))]}))],2)},R=[],H={name:"myLeftNav",props:["navData"],data(){return{listStatus:null}},methods:{routerPushTo(t,e){if(console.log("开始跳转"),console.log(this.listStatus[t]),!0!==this.listStatus[t]){console.log("改变路由");for(let t=0;t<this.listStatus.length;t++)!0===this.listStatus[t]&&this.listStatus.splice(t,1,!1);this.listStatus.splice(t,1,!0),this.$router.push(e)}}},created(){this.listStatus=new Array(this.navData.length).fill(!1),this.navData.forEach(((t,e)=>{this.$route.path===t.path&&(this.listStatus[e]=!0)}))}},U=H,q=(0,u.A)(U,z,R,!1,null,"15acfbf8",null),j=q.exports,V={name:"scheduleBlock",components:{myLeftNav:j},data(){return{navData:[{name:"我的日程",path:"/scheduleBlock/mySchedule"},{name:"待办事项",path:"/scheduleBlock/todoList"},{name:"统计数据",path:"/scheduleBlock/scheduleStatistic"}]}},methods:{},created(){}},J=V,Y=(0,u.A)(J,M,N,!1,null,"21a56970",null),G=Y.exports,W=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"todoList"}},[e("div",{staticClass:"filterBlock"},[e("div",{staticClass:"fit-content-centerBox"},[e("el-input",{staticClass:"search",attrs:{placeholder:"查询待办事项"},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}}),e("el-button",{on:{click:t.getTodoData}},[t._v("搜索")])],1),e("div",{staticClass:"fit-content-centerBox"},[e("el-date-picker",{attrs:{type:"month","value-format":"yyyy-MM",placeholder:"选择年月"},on:{change:t.getTodoData},model:{value:t.selectedDate,callback:function(e){t.selectedDate=e},expression:"selectedDate"}})],1),e("div",{staticClass:"fit-content-centerBox"},[e("span",{class:{isChoose:t.typeChoose[0]},on:{click:function(e){return t.change_page_typeChoose(0)}}},[t._v("已完成")]),e("span",{class:{isChoose:t.typeChoose[1]},on:{click:function(e){return t.change_page_typeChoose(1)}}},[t._v("未完成")]),e("span",{class:{isChoose:t.typeChoose[2]},on:{click:function(e){return t.change_page_typeChoose(2)}}},[t._v("全选")])])]),e("div",{staticClass:"itemContentBlock"},[e("div",{staticClass:"itemControl_buttonGroup fit-content-centerBox"},[e("el-button",[t._v("刷新")]),e("el-button",{on:{click:function(e){return t.openEditor("add")}}},[t._v("添加")])],1),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.dataLoading,expression:"dataLoading"}]},[t._l(t.todo_show,(function(s,i){return[e("div",{key:i+""+s.uid,staticClass:"todoItem"},[e("div",{staticClass:"todoItem-content"},[e("h3",{staticClass:"todoItem-title"},[t._v(" "+t._s(s.name)+" "),e("el-tag",{attrs:{type:s.isFin?"success":"info",size:"small"}},[t._v(" "+t._s(s.isFin?"已完成":"未完成")+" ")])],1),e("span",{staticClass:"todoItem-date"},[t._v("截至日期："+t._s(s.dateEnd))]),e("div",{staticClass:"todoItem-description"},[t._v(t._s(s.description))]),e("div",{staticClass:"todoItem-tags"},t._l(s.label,(function(s){return e("el-tag",{key:s,attrs:{size:"small"}},[t._v(t._s(s))])})),1)]),e("div",{staticClass:"todoItem-actions"},[e("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(e){return t.openEditor("edit",s)}}},[t._v("编辑")]),e("el-popconfirm",{attrs:{"confirm-button-text":"确定","cancel-button-text":"不用了",icon:"el-icon-info","icon-color":"red",title:"确定要删除这条日程记录吗？"},on:{confirm:function(e){return t.deleteItem(s.uid)}}},[e("el-button",{attrs:{slot:"reference",type:"danger",icon:"el-icon-delete",size:"mini"},slot:"reference"},[t._v("删除")])],1)],1)]),e("div",{key:"sup"+i+s.id,staticStyle:{"margin-bottom":"10px"}})]}))],2)]),e("div",{staticClass:"fit-content-centerBox"},[e("myPagination",{attrs:{nowPage:t.nowPage,pageSize:t.pageSize,dataLength:t.totalLength},on:{refresh:t.page_refresh}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showEditor,expression:"showEditor"}],staticClass:"mask",on:{click:t.closeEditor}}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showEditor,expression:"showEditor"}],staticClass:"editorBlock"},[e("h3",[t._v(t._s("add"===t.editorMode?"添加待办事项":"编辑待办事项"))]),e("el-input",{attrs:{placeholder:"名称"},model:{value:t.editorData.name,callback:function(e){t.$set(t.editorData,"name",e)},expression:"editorData.name"}}),e("el-input",{attrs:{type:"textarea",placeholder:"描述"},model:{value:t.editorData.description,callback:function(e){t.$set(t.editorData,"description",e)},expression:"editorData.description"}}),e("el-select",{attrs:{multiple:"",placeholder:"标签"},model:{value:t.editorData.label,callback:function(e){t.$set(t.editorData,"label",e)},expression:"editorData.label"}},[t._l(t.labelOptions,(function(t){return e("el-option",{key:t,attrs:{label:t,value:t}})})),e("el-input",{attrs:{placeholder:"输入自定义标签并按Enter"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addCustomLabel.apply(null,arguments)}},model:{value:t.labelInput,callback:function(e){t.labelInput=e},expression:"labelInput"}})],2),e("el-date-picker",{attrs:{type:"datetime",placeholder:"截止日期"},model:{value:t.editorData.dateEnd,callback:function(e){t.$set(t.editorData,"dateEnd",e)},expression:"editorData.dateEnd"}}),e("div",{staticClass:"button-group"},[e("el-button",{on:{click:t.saveEditorData}},[t._v("保存")]),e("el-button",{on:{click:t.closeEditor}},[t._v("取消")])],1)],1)])},K=[],Z=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"myPagination"}},[e("el-pagination",{attrs:{"current-page":t.nowPage,"page-sizes":[10,20,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.dataLength},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)},Q=[],X={name:"myPagination",props:["nowPage","pageSize","dataLength"],components:{},methods:{handleSizeChange(t){this.$emit("refresh","sizeChange",t)},handleCurrentChange(t){this.$emit("refresh","currentChange",t)}}},tt=X,et=(0,u.A)(tt,Z,Q,!1,null,null,null),st=et.exports,it={name:"todoList",components:{myPagination:st},data(){return{nowPage:1,pageSize:10,totalLength:0,searchValue:null,dataLoading:!0,typeChoose:[!1,!1,!0],selectedDate:null,todo_show:[],todo_data:[],showEditor:!1,editorMode:"add",editorData:{name:"",description:"",isFin:!1,label:[],dateEnd:null},labelInput:"",labelOptions:["工作","学习","生活"]}},methods:{...(0,l.L8)("auth",["user"]),getTodoData(){this.dataLoading=!0;let t={userId:this.user().uid,name:this.searchValue,dateSelected:this.selectedDate};this.typeChoose[0]?t.isFin=!0:this.typeChoose[1]?t.isFin=!1:t.isFin=null,this.$axios.post("api/user/todolist/read",t).then((t=>{this.todo_data.splice(0,this.todo_data.length,...t.data),this.totalLength=this.todo_data.length,this.nowPage>1&&(this.nowPage-1)*this.pageSize>=this.totalLength&&(this.nowPage=1),this.page_refresh(),this.$message.success("待办事项加载成功")})).catch((t=>{console.log(t),this.$message.error("加载待办事项失败")})),this.dataLoading=!1},addCustomLabel(){this.labelInput?this.editorData.label.includes(this.labelInput)?this.$message.error("标签已存在"):(this.$message.success("标签添加成功"),this.editorData.label.push(this.labelInput),this.labelInput=""):this.$message.error("标签不能为空"),console.log(this.labelInput)},change_page_typeChoose(t){if(!0!==this.typeChoose[t]){for(let t=0;t<this.typeChoose.length;t++)!0===this.typeChoose[t]&&this.typeChoose.splice(t,1,!1);this.typeChoose.splice(t,1,!0)}this.getTodoData()},page_refresh(...t){this.dataLoading=!0,0!==t.length&&("currentChange"===t[0]?this.nowPage=t[1]:"sizeChange"===t[0]&&(this.pageSize=t[1]));let e=this.todo_data.slice((this.nowPage-1)*this.pageSize,this.nowPage*this.pageSize);this.todo_show.splice(0,this.todo_show.length,...JSON.parse(JSON.stringify(e))),this.dataLoading=!1},openEditor(t,e){this.editorMode=t,this.showEditor=!0,this.editorData="edit"===t&&e?JSON.parse(JSON.stringify(e)):{name:"",description:"",label:[],DateEnd:null,isFin:!1}},closeEditor(){this.showEditor=!1},saveEditorData(){"add"===this.editorMode?this.$axios.post("api/user/todolist/create",{...this.editorData,userId:this.user().uid}).then((t=>{console.log(t.data),this.getTodoData(),this.$message.success("待办事项添加成功")})).catch((t=>{console.log(t),this.$message.error("添加待办事项失败")})):this.todo_data.forEach(((t,e)=>{t.uid===this.editorData.uid&&(this.editorData.userId=this.user().uid,this.$axios.post("api/user/todolist/update",this.editorData).then((()=>{this.todo_data.splice(e,1,JSON.parse(JSON.stringify(this.editorData))),this.page_refresh(),this.$message.success("待办事项更新成功")})).catch((t=>{console.log(t),this.$message.error("更新待办事项失败")})))})),this.closeEditor()},deleteItem(t){console.log(t),this.$axios.post("api/user/todolist/delete",{uid:t}).then((()=>{this.todo_data.forEach(((e,s)=>{e.uid===t&&this.todo_data.splice(s,1)})),this.page_refresh(),this.$message.success("待办事项删除成功")})).catch((t=>{console.log(t),this.$message.error("删除待办事项失败")}))}},created(){this.dataLoading=!0,this.$axios.post("api/user/todolist/read",{userId:this.user().uid}).then((t=>{this.todo_data.splice(0,0,...t.data),this.totalLength=this.todo_data.length,this.page_refresh(),this.$message.success("待办事项加载成功")})).catch((t=>{console.log(t),this.$message.error("加载待办事项失败")}))}},at=it,ot=(0,u.A)(at,W,K,!1,null,"0f6f2c4f",null),nt=ot.exports,rt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"p20",attrs:{id:"scheduleStatistic"}},[e("lineStatic",{attrs:{echartTitle:this.echartTitle,echartSeries:this.echartSeries}}),e("button",{on:{click:t.getEchartSeries}},[t._v("获取折线图数据")])],1)},lt=[],ct=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"lineStaticComponent"}},[e("div",{ref:"lineStatic"},[t._v(" "+t._s(t.option.title.text+t.option.series.length)+" ")])])},dt=[],ut={name:"lineStatic",mounted(){this.initChart()},props:{echartTitle:{type:String,default:null},echartSeries:{type:Array,default:null}},computed:{option(){return{title:{text:this.echartTitle},series:this.echartSeries}}},methods:{}},ht=ut,pt=(0,u.A)(ht,ct,dt,!1,null,"c99bfd10",null),mt=pt.exports,gt={name:"scheduleStatistic",components:{lineStatic:mt},data(){return{echartTitle:"折线图",echartSeries:[]}},methods:{getEchartSeries(){this.echartSeries.push({name:"折线图",type:"line",data:[1,2,3,4,5,6,7,8,9,10]})}}},ft=gt,vt=(0,u.A)(ft,rt,lt,!1,null,null,null),Ct=vt.exports,_t=function(){var t=this,e=t._self._c;return e("div",{staticClass:"p20",attrs:{id:"mySchedule"}},[e("div",{staticClass:"nowAndHistorySchedule flex-display"},[e("div",{class:{isChoose:t.nowAndHistoryChoose[0]},on:{click:function(e){return t.changeNowAndHistoryChoose(0)}}},[t._v("今日日程")]),e("span",[t._v("|")]),e("div",{class:{isChoose:t.nowAndHistoryChoose[1]},on:{click:function(e){return t.changeNowAndHistoryChoose(1)}}},[t._v("日程管理")])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isTodayShow,expression:"isTodayShow"}]},[t.todaySchedule?e("div",{staticClass:"scheduleInfoToday"},[e("div",{staticClass:"titleAndDate"},[t._v(" "+t._s(this.todaySchedule.name)+" "),e("span",{staticClass:"currentTime"},[t._v(t._s(t.currentTime))])]),e("div",[t._v("日期："+t._s(this.todaySchedule.dateStr))]),e("div",{staticClass:"hourlyTaskContent"},[t._l(t.todayScheduleHourlyTask,(function(s,i){return[e("div",{key:s.id+i,class:["schedulehourlyTaskMain",s.statusClass]},[e("div",[t._v(" "+t._s(i+1+".")+t._s(s.name)+" ")]),e("div",[t._v(t._s(s.start)+"-"+t._s(s.end))])]),e("div",{key:s.id+i+3,staticClass:"hourlyTaskDescription"},[e("span",[t._v("备注:")]),t._v(t._s(s.hourlyTaskDescription)+" ")])]}))],2)]):t._e()]),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isTodayShow,expression:"!isTodayShow"}]},[e("div",{staticClass:"filter"},[e("el-button",{on:{click:function(e){return t.openEdit("add")}}},[e("i",{staticClass:"el-icon-plus"}),t._v("添加")])],1),e("div",{staticClass:"myScheduleMain"},t._l(t.scheduleInfo_show,(function(s){return e("el-card",{key:s.uid,staticClass:"schedule-card"},[e("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[e("span",{staticClass:"title"},[t._v(t._s(s.name))]),e("div",{staticClass:"button-group"},[e("el-button",{attrs:{icon:s.visible?"el-icon-close":"el-icon-view",circle:""},on:{click:function(e){return t.showhourlyTaskContent(s.uid)}}}),e("el-button",{attrs:{icon:"el-icon-edit-outline",circle:""},on:{click:function(e){return t.openEdit("update",s.uid)}}}),e("el-popconfirm",{attrs:{"confirm-button-text":"确定","cancel-button-text":"取消",icon:"el-icon-warning",title:"确定要删除这条日程记录吗？"},on:{confirm:function(e){return t.deleteOneDaySchedule(s.uid)}}},[e("el-button",{attrs:{slot:"reference",icon:"el-icon-delete",circle:""},slot:"reference"})],1)],1)]),e("div",{staticClass:"card-content"},[e("p",{staticClass:"date"},[t._v("日期："+t._s(s.dateStr))]),e("el-collapse-transition",[e("div",{directives:[{name:"show",rawName:"v-show",value:s.visible,expression:"itema.visible"}],staticClass:"hourly-task-list"},[e("el-timeline",t._l(s.hourlyTask,(function(i,a){return e("el-timeline-item",{key:s.uid+(i.uid?i.uid:i._id),attrs:{timestamp:i.start+" - "+i.end}},[e("h3",[t._v(t._s(a+1)+". "+t._s(i.name))]),e("p",{staticClass:"description"},[t._v("备注: "+t._s(i.hourlyTaskDescription))])])})),1)],1)])],1)])})),1),e("div",{staticClass:"pageSelect fit-content-centerBox"},[e("myPagination",{attrs:{nowPage:t.pageInfo.nowPage,pageSize:t.pageInfo.pageSize,dataLength:t.pageInfo.totalLength},on:{refresh:t.page_refresh}})],1)]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isEditorOpen,expression:"isEditorOpen"}],staticClass:"maskLayer"}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isEditorOpen,expression:"isEditorOpen"}],staticClass:"editorBlock"},[e("div",{staticClass:"addOnehourlyTask"},[e("el-button",{on:{click:function(e){return t.addOnehourlyTask()}}},[e("i",{staticClass:"el-icon-plus"}),e("span",[t._v("添加时段")])])],1),"update"==t.editorType?e("div",{staticClass:"edTitile"},[t._v("日程修改")]):"add"==t.editorType?e("div",{staticClass:"edTitile"},[t._v("日程添加")]):t._e(),e("div",{staticClass:"titleEditor"},[e("div",{staticClass:"nameEditor"},[e("el-input",{attrs:{placeholder:"请输入日程名"},model:{value:t.editorData.name,callback:function(e){t.$set(t.editorData,"name",e)},expression:"editorData.name"}})],1),e("div",[e("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:t.editorData.dateStr,callback:function(e){t.$set(t.editorData,"dateStr",e)},expression:"editorData.dateStr"}})],1)]),!t.editorData.hourlyTask.length?t._e():e("div",{staticClass:"hourlyTaskEditor"},[t._l(t.editorData.hourlyTask,(function(s,i){return[e("div",{key:t.editorData.uid+(s.uid?s.uid:s._id),staticClass:"onehourlyTaskAddBlock"},[e("div",[e("el-input",{attrs:{placeholder:"请输入时段任务名"},model:{value:s.name,callback:function(e){t.$set(s,"name",e)},expression:"item.name"}})],1),e("div",[e("span",[t._v("开始时段：")]),e("div",[e("el-time-picker",{attrs:{format:"HH:mm","value-format":"HH:mm"},on:{change:function(e){return t.timeChecking("start",i)}},model:{value:s.start,callback:function(e){t.$set(s,"start",e)},expression:"item.start"}}),e("span",{staticClass:"supposeText"},[t._v(t._s(t.editorRelative.supposeStart[i]))])],1),e("span",[t._v("结束时段：")]),e("div",[e("el-time-picker",{attrs:{format:"HH:mm","value-format":"HH:mm",disabled:!s.start},on:{change:function(e){return t.timeChecking("end",i)}},model:{value:s.end,callback:function(e){t.$set(s,"end",e)},expression:"item.end"}}),e("span",{staticClass:"supposeText"},[t._v(t._s(t.editorRelative.supposeEnd[i]))])],1)]),e("div",{staticClass:"descriptionEditor"},[t._v(" 备注： "),e("div",[e("el-input",{attrs:{type:"textarea"},model:{value:s.hourlyTaskDescription,callback:function(e){t.$set(s,"hourlyTaskDescription",e)},expression:"item.hourlyTaskDescription"}})],1)])])]}))],2),e("div",{staticClass:"eitorButtonGroup"},[e("div",[e("el-button",{attrs:{type:"warning"},on:{click:function(e){return t.closeEdit()}}},[t._v("取消")])],1),e("div",["add"==t.editorType?e("el-button",{attrs:{type:"success"},on:{click:function(e){return t.queryEdit("add")}}},[t._v("添加")]):"update"==t.editorType?e("el-button",{attrs:{type:"success"},on:{click:function(e){return t.queryEdit("update")}}},[t._v("修改")]):t._e()],1)])])])},yt=[];let It={getHourStrToMinNumber:function(t){let e=t.split(":"),s=("0"==e[0][0]?60*parseInt(e[0][1]):60*parseInt(e[0]))+("0"==e[1][0]?parseInt(e[1][1]):parseInt(e[1]));return s},formatDate(t){return new Date(t).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/\//g,"-").replace(",","")}};var wt=It,St={name:"mySchedule",components:{myPagination:st},data(){return{pageInfo:{nowPage:1,pageSize:10,totalLength:0},nowDateStr:null,nowAndHistoryChoose:[!0,!1],nowAndHistoryChoose_nowIndex:0,isTodayShow:!0,isEditorOpen:!1,editorType:"add",editorId:null,editorRelative:{hourlyTaskItemAdd:[],supposeStart:[],supposeEnd:[]},editorData:{name:"",dateStr:null,hourlyTask:[]},todaySchedule:null,scheduleInfo_show:[],scheduleInfo_data:[],currentTime:""}},computed:{todayScheduleHourlyTask(){return this.todaySchedule.hourlyTask.map((t=>({...t,statusClass:this.currentTime<t.start?"not-started":this.currentTime<=t.end?"in-progress":"completed"})))}},mounted(){this.updateTime(),setInterval(this.updateTime,1e3)},methods:{...(0,l.PY)("idCount",["setIdCount"]),...(0,l.L8)("idCount",["idCount"]),...(0,l.L8)("auth",["user"]),getScheduleData(){this.$axios.post("api/user/schedule/read",{userId:this.user().uid}).then((t=>{t.data.forEach((t=>{t.visible=!1})),this.scheduleInfo_data.splice(0,this.scheduleInfo_data.length,...t.data),this.pageInfo.totalLength=this.scheduleInfo_data.length,this.page_refresh(),this.$message.success("日程加载成功")})).catch((t=>{console.log(t),this.$message.error("加载日程失败")}))},timeChecking(t,e){this.editorRelative.supposeStart[e]=null,this.editorRelative.supposeEnd[e]=null;let s=this.editorData.hourlyTask[e].start.split(":"),i=("0"==s[0][0]?60*parseInt(s[0][1]):60*parseInt(s[0]))+("0"==s[1][0]?parseInt(s[1][1]):parseInt(s[1])),a=null;if(this.editorData.hourlyTask[e].end){let t=this.editorData.hourlyTask[e].end.split(":");a=("0"==t[0][0]?60*parseInt(t[0][1]):60*parseInt(t[0]))+("0"==t[1][0]?parseInt(t[1][1]):parseInt(t[1]))}if(a&&a<=i)return this.$message.error("结束时间必须大于开始时间！"),this.editorData.hourlyTask[e].end=null,null;let o=[];for(let n=0;n<this.editorData.hourlyTask.length;n++)if(n!=e&&this.editorData.hourlyTask[n].start&&this.editorData.hourlyTask[n].end){let[t,e]=[this.editorData.hourlyTask[n].start.split(":"),this.editorData.hourlyTask[n].end.split(":")],s=("0"==t[0][0]?60*parseInt(t[0][1]):60*parseInt(t[0]))+("0"==t[1][0]?parseInt(t[1][1]):parseInt(t[1])),i=("0"==e[0][0]?60*parseInt(e[0][1]):60*parseInt(e[0]))+("0"==e[1][0]?parseInt(e[1][1]):parseInt(e[1]));o.push({startMin:s,endMin:i})}if(o.length){let s=!0,n=-1,r=1441;if("start"==t){for(let t of o)t.startMin==i&&(this.$message.error("起始时间与已有时段的起始时间相同！"),s=!1),t.startMin<i&&t.endMin>i&&(this.$message.error("起始时间不能在已有时段中间"),s=!1),a&&a>t.endMin&&(n=t.endMin);if(i<n){s&&this.$message.error("与其他时间段相交！");let t=Math.floor(n/60)+"时"+n%60+"分";this.editorRelative.supposeStart[e]="建议起始时间:>="+t,s=!1}s||(this.editorData.hourlyTask[e].start=null)}else if("end"==t){for(let t of o)t.endMin==a&&(this.$message.error("结束时间与已有时段的结束时间相同！"),s=!1),t.startMin<a&&t.endMin>a&&(this.$message.error("结束时间不能在已有时段中间"),s=!1),i&&i<t.startMin&&(r=t.startMin);if(a>r){s&&this.$message.error("与其他时间段相交！");let t=Math.floor(r/60)+"时"+r%60+"分";this.editorRelative.supposeEnd[e]="建议结束时间:<="+t,s=!1}s||(this.editorData.hourlyTask[e].end=null)}}},changeNowAndHistoryChoose(t){this.nowAndHistoryChoose_nowIndex!=t&&(this.nowAndHistoryChoose.splice(this.nowAndHistoryChoose_nowIndex,1,!1),this.nowAndHistoryChoose.splice(t,1,!0),this.nowAndHistoryChoose_nowIndex=t,this.isTodayShow=!this.isTodayShow,1==t&&this.$axios.post("api/user/schedule/read",{userId:this.user().uid}).then((t=>{t.data.forEach((t=>{t.visible=!1})),this.scheduleInfo_data.splice(0,this.scheduleInfo_data.length,...t.data),this.pageInfo.totalLength=this.scheduleInfo_data.length,this.page_refresh()})).catch((t=>{console.log("发生了错误："),console.log(t)})))},showhourlyTaskContent(t){for(let e=0;e<this.scheduleInfo_show.length;e++)if(this.scheduleInfo_show[e].uid===t){this.scheduleInfo_show[e].visible=!this.scheduleInfo_show[e].visible;let t=JSON.parse(JSON.stringify(this.scheduleInfo_show[e]));this.scheduleInfo_show.splice(e,1,t)}},deleteOneDaySchedule(t){this.$axios.post("api/user/schedule/delete",{uid:t,userId:this.user().uid}).then((()=>{this.getScheduleData()}))},openEdit(t,...e){if("add"==t)this.editorType="add",this.setIdCount(),this.editorData={id:this.idCount()+"s"+(new Date).getTime(),name:"",dateStr:null,hourlyTask:[]};else if("update"==t){for(let t of this.scheduleInfo_show)if(t.uid==e[0]){this.editorData=JSON.parse(JSON.stringify(t));break}this.editorType="update",this.editorId=e[0]}this.isEditorOpen=!0},closeEdit(){this.isEditorOpen=!1},queryEdit(t){if("add"==t){let t=JSON.parse(JSON.stringify(this.editorData.hourlyTask));t.sort(((t,e)=>{let s=wt.getHourStrToMinNumber(t.start),i=wt.getHourStrToMinNumber(e.end);return s>=i?1:-1})),this.editorData.hourlyTask=t,this.editorData.visible=!1;let{id:e,hourlyTask:s,name:i,dateStr:a}=this.editorData;this.$axios.post("api/user/schedule/create",{uid:e,hourlyTask:s,name:i,dateStr:a,userId:this.user().uid}).then((()=>{this.getScheduleData()}))}else if("update"==t)for(let e in this.scheduleInfo_show)if(this.scheduleInfo_show[e].uid==this.editorId){this.$axios.post("api/user/schedule/update",this.editorData).then((()=>{this.getScheduleData()}));break}this.isEditorOpen=!1},addOnehourlyTask(){let t=!0;if(0!=this.editorData.hourlyTask.length)for(let e=0;e<this.editorData.hourlyTask.length;e++)if(""==this.editorData.hourlyTask[e].name||null==this.editorData.hourlyTask[e].start||null==this.editorData.hourlyTask[e].end){this.$message.error("请确保已有的时段任务中信息填写完整！"),t=!1;break}t&&(this.setIdCount(),this.editorData.hourlyTask.push({_id:this.idCount()+"s"+(new Date).getTime(),uid:null,name:"",start:null,end:null,hourlyTaskDescription:""}),this.editorRelative.hourlyTaskItemAdd.push(""),this.editorRelative.supposeEnd.push(null),this.editorRelative.supposeStart.push(null))},addOnehourlyTaskItem(t){this.setIdCount(),this.editorData.hourlyTask[t].hourlyTaskItem.push({id:this.idCount()+"s"+(new Date).getTime(),name:this.editorRelative.hourlyTaskItemAdd[t]}),this.editorRelative.hourlyTaskItemAdd[t]=""},getOneDaySchedule(t){this.$axios.post("api/user/schedule/read",{whichDate:t,userId:this.user().uid}).then((t=>{t.data&&!t.data.length?this.$message.error("今天还没有创建日程"):(this.todaySchedule=t.data[0],this.$message({type:"success",message:"今日日程加载成功"}))})).catch((()=>{this.$message.error("加载今日日程失败")}))},page_refresh(...t){this.dataLoading=!0,0!==t.length&&("currentChange"===t[0]?this.pageInfo.nowPage=t[1]:"sizeChange"===t[0]&&(this.pageInfo.pageSize=t[1]));let e=this.scheduleInfo_data.slice((this.pageInfo.nowPage-1)*this.pageInfo.pageSize,this.pageInfo.nowPage*this.pageInfo.pageSize);this.scheduleInfo_show.splice(0,this.scheduleInfo_show.length,...JSON.parse(JSON.stringify(e))),this.dataLoading=!1},updateTime(){const t=new Date;this.currentTime=t.toLocaleTimeString("zh-CN",{hour12:!1})}},created(){(()=>{let t=new Date;this.nowDateStr=t.getFullYear()+"-"+(t.getMonth()+1>=10?t.getMonth()+1:"0"+(t.getMonth()+1))+"-"+(t.getDate()>=10?t.getDate():"0"+t.getDate()),this.getOneDaySchedule(this.nowDateStr,"today")})()}},kt=St,bt=(0,u.A)(kt,_t,yt,!1,null,"78425e7e",null),xt=bt.exports,Tt={namespaced:!0,state:{token:localStorage.getItem("token")||"",user:null,profileUrl:null,username:null},getters:{isAuthenticated:t=>!!t.token,user:t=>t.user,profileUrl:t=>t.profileUrl,username:t=>t.username},actions:{async login({commit:t,dispatch:e},s){try{const a=await i["default"].prototype.$axios.post("/api/user/auth/login",s),o=a.data.token;return localStorage.removeItem("token"),localStorage.setItem("token",o),await e("fetchUser"),t("SET_TOKEN",o),!0}catch(a){return console.error("登录失败:",a),!1}},async logout({commit:t}){t("CLEAR_AUTH")},async fetchUser({commit:t}){try{const e=await i["default"].prototype.$axios.post("/api/user/auth/getUserInfo");200===e.status&&(t("SET_USER",e.data.userInfo),t("SET_PROFILE_URL",e.data.userBaseInfo.profileUrl),t("SET_USERNAME",e.data.userBaseInfo.name))}catch(e){e.response&&401===e.response.status&&(console.log("token失效，请重新登录"),t("CLEAR_AUTH"))}}},mutations:{SET_TOKEN(t,e){t.token=e},SET_USER(t,e){t.user=e},SET_PROFILE_URL(t,e){t.profileUrl=e},SET_USERNAME(t,e){t.username=e},CLEAR_AUTH(t){t.token="",t.user={},localStorage.removeItem("token")}}},$t={namespaced:!0,state:{idCount:0},mutations:{setIdCount(t){t.idCount=t.idCount+1}},getters:{idCount:t=>t.idCount}},Ft={namespaced:!0,state:{myCollectionId:null},mutations:{setMyCollectionId(t,e){t.myCollectionId=e}},actions:{},getters:{myCollectionId:t=>t.myCollectionId}},At={namespaced:!0,state:{isBgBlack:!1},mutations:{setBgBlack(t,e){t.isBgBlack=e}}};i["default"].use(l.Ay);var Dt=new l.Ay.Store({state:{},mutations:{},actions:{},getters:{},modules:{auth:Tt,idCount:$t,post:Ft,pageStatus:At}}),Lt=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"editor-block"}},[e("div",{staticClass:"editorNav"},[e("myLeftNav",{attrs:{navData:t.navData}})],1),e("div",{staticClass:"editorMain"},[e("router-view")],1)])},Et=[],Bt={name:"editorBlock",components:{myLeftNav:j},data(){return{navData:[{name:"创作管理",path:"/editorBlock/creationManagement"},{name:"稿件数据",path:"/editorBlock/creationStatistics"}]}},computed:{}},Pt=Bt,Ot=(0,u.A)(Pt,Lt,Et,!1,null,"2ab02059",null),Mt=Ot.exports,Nt=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"editorPage"}},[e("el-input",{attrs:{placeholder:"请输入文章标题"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),e("mavonEditor",{ref:"md",on:{save:t.saveArticle,imgAdd:t.addImg,imgDel:t.delImg},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),e("div",{staticClass:"tagArray flex-display"},[t._l(t.tagArray,(function(s,i){return e("el-tag",{key:i+""+s,attrs:{closable:""},on:{close:function(e){return t.handleTagClose(s)}}},[t._v(t._s(s))])})),e("el-input",{attrs:{placeholder:"添加标签"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addTag.apply(null,arguments)}},model:{value:t.newTag,callback:function(e){t.newTag=e},expression:"newTag"}})],2),e("div",{staticClass:"buttonGroup"},[e("el-popconfirm",{attrs:{"confirm-button-text":"确定","cancel-button-text":"取消",icon:"el-icon-warning",title:"确定发布这篇文章吗？"},on:{confirm:t.publishArticle}},[e("el-button",{attrs:{slot:"reference",type:"success"},slot:"reference"},[t._v("发布")])],1)],1)],1)},zt=[],Rt={name:"editorPage",components:{},computed:{},data(){return{content:"",title:"",tagArray:[],newTag:"",articleId:"",articleStatus:null,timer:null}},created(){"new"!==this.$route.query.articleId?(this.articleId=this.$route.query.articleId,this.$axios.post("/api/user/post/read",{id:this.articleId,option:"getOne"}).then((t=>{200===t.status&&(console.log(t.data),this.content=t.data.post.content,this.title=t.data.post.title,this.tagArray=t.data.post.tag,this.articleStatus=t.data.post.status)})).catch((t=>{console.log(t)}))):this.articleStatus=-1},methods:{...(0,l.L8)("auth",["user"]),addTag(){if(this.newTag){if(10===this.tagArray.length)return void this.$message.warning("标签数量已达上限:10");for(let t=0;t<this.tagArray.length;t++)if(this.tagArray[t]===this.newTag)return void this.$message.warning("标签已存在");this.tagArray.push(this.newTag),this.newTag=""}},handleTagClose(t){for(let e=0;e<this.tagArray.length;e++)if(this.tagArray[e]===t){this.tagArray.splice(e,1);break}},saveArticle(){clearTimeout(this.timer),this.timer=setTimeout((()=>{-1===this.articleStatus?this.$axios.post("/api/user/post/create",{title:this.title,content:this.content,tag:this.tagArray,userId:this.user().uid,status:0}).then((t=>{200===t.status&&(this.$message.success("文章草稿箱保存成功"),this.articleId=t.data.id,this.articleStatus=0)})).catch((t=>{console.log(t)})):this.$axios.post("/api/user/post/update",{id:this.articleId,title:this.title,content:this.content,tag:this.tagArray,status:0}).then((t=>{200===t.status&&this.$message.success("文章草稿箱更新成功")})).catch((t=>{console.log(t)}))}),500)},publishArticle(){this.title&&this.content&&0!==this.tagArray.length?(clearTimeout(this.timer),this.timer=setTimeout((()=>{-1===this.articleStatus?this.$axios.post("/api/user/post/create",{title:this.title,content:this.content,tag:this.tagArray,userId:this.user().uid,status:1}).then((t=>{200===t.status&&(this.$message.success("发布文章成功"),this.articleId=t.data.id,this.articleStatus=1,this.$router.go(0))})).catch((t=>{console.log(t)})):this.$axios.post("/api/user/post/update",{id:this.articleId,title:this.title,content:this.content,tag:this.tagArray,status:1}).then((t=>{200===t.status&&this.$message.success("文章发布成功")})).catch((t=>{console.log(t)}))}),500)):this.$message.warning("标题、内容、标签不能为空")},addImg(t,e){const s=new FormData;s.append("img",e),this.$axios.post("/api/user/post/uploadImage",s,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>200===e.status?(this.$message.success("图片上传成功"),this.$refs.md.$img2Url(t,e.data.url),!0):(this.$message.error("图片上传失败"),!1))).catch((t=>{console.log(t)}))},delImg(t){const e=/[\d\w-]*\.jpg/,s=t[0].match(e)[0];this.$axios.post("/api/user/post/deleteImage",{fileName:s}).then((t=>{if(200===t.status)return this.$message.success("图片删除成功"),!0})).catch((t=>{console.log(t)}))}}},Ht=Rt,Ut=(0,u.A)(Ht,Nt,zt,!1,null,null,null),qt=Ut.exports,jt=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"creationManagement"}},[e("div",{staticClass:"articleStatus"},[e("div",{class:{isChoose:!0===t.articleStatus[1]},on:{click:function(e){return t.changeArticleStatus(1)}}},[t._v("已发布")]),e("div",{class:{isChoose:!0===t.articleStatus[0]},on:{click:function(e){return t.changeArticleStatus(0)}}},[t._v("草稿箱")]),e("div",{class:{isChoose:!0===t.articleStatus[2]},on:{click:function(e){return t.changeArticleStatus(2)}}},[t._v("回收站")])]),e("div",{staticClass:"searchFilter"},[e("div",[e("el-date-picker",{attrs:{type:"month","value-format":"yyyy-MM",placeholder:"选择年月"},model:{value:t.searchOption.date,callback:function(e){t.$set(t.searchOption,"date",e)},expression:"searchOption.date"}})],1),e("div",[e("el-input",{attrs:{placeholder:"搜索内容"},model:{value:t.searchOption.title,callback:function(e){t.$set(t.searchOption,"title",e)},expression:"searchOption.title"}})],1),e("div",[e("el-button",{on:{click:function(e){return t.getArticleList(t.nowStatus)}}},[t._v("搜索")])],1)]),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"articleList"},[t._l(t.articleList,(function(s){return[e("div",{key:s.id,staticClass:"articleItem"},[e("div",[e("div",{staticClass:"articleTitle"},[t._v(t._s(s.title))]),e("div",{staticClass:"articleManageBtn"},[e("el-button",{on:{click:function(e){return t.editArticle(s.id)}}},[t._v("编辑")]),e("el-popconfirm",{attrs:{"confirm-button-text":"确定","cancel-button-text":"取消",icon:"el-icon-warning",title:"确定要把文章放进回收站吗？"},on:{confirm:function(e){return t.deleteArticle(s.id)}}},[2!==t.nowStatus?e("el-button",{attrs:{slot:"reference"},slot:"reference"},[t._v("删除")]):t._e()],1),e("el-button",{on:{click:function(e){return t.previewArticle(s.id)}}},[t._v("预览")]),1!==t.nowStatus?e("el-button",{on:{click:function(e){return t.moveArticleToPublish(s.id)}}},[t._v("发布")]):t._e(),0!==t.nowStatus?e("el-button",{on:{click:function(e){return t.moveArticleToDraft(s.id)}}},[t._v("移入草稿")]):t._e()],1)]),e("div",[e("div",{staticClass:"articleData"},[e("span",[t._v("阅读量："+t._s(s.viewCount))]),e("span",[t._v("点赞量："+t._s(s.appraise))]),e("span",[t._v("收藏量："+t._s(s.collection))])]),e("div",{staticClass:"articleCreateAt"},[t._v("创建于："+t._s(t.formatDate(s.createdAt)))])])])]}))],2),e("el-pagination",{attrs:{"current-page":t.pageInfo.page,"page-sizes":[10,20,50],"page-size":t.pageInfo.size,layout:"total, sizes, prev, pager, next, jumper",total:t.pageInfo.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)},Vt=[],Jt={name:"creationManagement",components:{},computed:{},data(){return{articleStatus:[!1,!0,!1],loading:!1,nowStatus:1,searchOption:{date:null,title:null},pageInfo:{page:1,size:10,total:0},articleList:[]}},mounted(){},methods:{...(0,l.L8)("auth",["user"]),handleSizeChange(t){this.pageInfo.size=t,this.getArticleList(this.nowStatus)},handleCurrentChange(t){this.pageInfo.page=t,this.getArticleList(this.nowStatus)},getArticleList(t){this.loading=!0,this.$axios.post("/api/user/post/read",{userId:this.user().uid,title:this.searchOption.title,date:this.searchOption.date,option:"getList",status:t,page:this.pageInfo.page,pageSize:this.pageInfo.size}).then((t=>{200===t.status&&(this.articleList.splice(0,this.articleList.length,...t.data.post),console.log(t.data.post),this.pageInfo.total=t.data.pageInfo.totalNum,this.pageInfo.page=t.data.pageInfo.page,this.pageInfo.size=t.data.pageInfo.pageSize,console.log(t.data.pageInfo),this.$message.success("获取文章列表成功"),this.loading=!1)})).catch((t=>{console.log(t),this.loading=!1}))},changeArticleStatus(t){if(!0!==this.articleStatus[t]){this.getArticleList(t);for(let t=0;t<this.articleStatus.length;t++)!0===this.articleStatus[t]&&this.articleStatus.splice(t,1,!1);this.articleStatus.splice(t,1,!0),this.nowStatus=t}},editArticle(t){this.$router.push({path:"/editorPage",query:{articleId:t}})},moveArticleToPublish(t){this.$axios.post("/api/user/post/update",{id:t,status:1}).then((t=>{200===t.status&&(this.$message.success("移动文章到发布成功"),this.getArticleList(this.nowStatus))})).catch((t=>{console.log(t)}))},moveArticleToDraft(t){console.log(t),this.$axios.post("/api/user/post/update",{id:t,status:0}).then((t=>{200===t.status&&(this.$message.success("移动文章到草稿箱成功"),this.getArticleList(this.nowStatus))})).catch((t=>{console.log(t)}))},deleteArticle(t){this.$axios.post("/api/user/post/update",{id:t,status:2}).then((t=>{200===t.status&&(this.$message.success("文章已放入回收站"),this.getArticleList(this.nowStatus))})).catch((t=>{console.log(t)}))},formatDate(t){return wt.formatDate(t)},previewArticle(t){let e=this.$router.resolve({path:"/viewPage",query:{articleId:t}});window.open(e.href,"_blank")}},created(){this.getArticleList(this.nowStatus)}},Yt=Jt,Gt=(0,u.A)(Yt,jt,Vt,!1,null,null,null),Wt=Gt.exports,Kt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"flex-display",attrs:{id:"viewPage"}},[e("div",{staticClass:"viewPageSideBar"},[e("div",{staticClass:"contentNav p10"},[e("h3",[t._v("内容导航")]),e("div",{staticClass:"p10"},[t._l(t.navList,(function(s){return[e("div",{key:s.id,staticClass:"cnav-item",style:`text-indent:${s.textSpace-1}em`,on:{click:function(e){return t.jumpToTag(s.id)}}},[t._v(t._s(s.text))])]}))],2)])]),e("div",{ref:"mdFather",staticClass:"postShow"},[e("div",{staticClass:"postHeader"},[e("h1",{staticClass:"postTitle"},[t._v(t._s(t.title))]),t._v(" "),e("div",{staticClass:"postMeta"},[e("span",{attrs:{title:`创建时间${t.formatDate(t.createTime)}`}},[e("i",{staticClass:"el-icon-time"}),t._v(" 更新时间："+t._s(t.formatDate(t.updateTime)))]),t._v(" "),e("span",[t.isCollection?e("i",{staticClass:"el-icon-star-on",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.collection_click(!1)}}}):e("i",{staticClass:"el-icon-star-off",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.collection_click(!0)}}}),t._v(" 收藏："+t._s(t.collectionCount)+" ")]),t._v(" "),e("span",[t.viewCount?e("i",{staticClass:"el-icon-view"}):t._e(),t._v(" 阅读："+t._s(t.viewCount))]),t._v(" "),e("span",[t.likeCount?e("i",{staticClass:"el-icon-thumb"}):t._e(),t._v(" 点赞："+t._s(t.likeCount))])]),e("div",{staticClass:"postTags"},t._l(t.tags,(function(s){return e("el-tag",{key:s,staticClass:"tag",attrs:{type:"primary"}},[t._v(t._s(s))])})),1)]),e("mavonEditor",{attrs:{toolbarsFlag:!1,subfield:!1,defaultOpen:"preview"},on:{change:t.onEditorReady},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),e("div",{staticClass:"viewPageSideBar"}),t.collectionEditorShow?e("div",{staticClass:"abusolute-center collectionEditor p20"},[t._m(0),e("div",{staticClass:"flex-display-center mt10 location-input"},[e("span",[t._v("收藏位置")]),e("el-input",{attrs:{placeholder:"根文件夹/.../目标文件夹"},model:{value:t.folderNameStr,callback:function(e){t.folderNameStr=e},expression:"folderNameStr"}})],1),e("div",{staticClass:"flex-display-center mt10"},[e("el-button",{attrs:{type:"primary"},on:{click:t.handleCollection}},[t._v("确定")]),e("el-button",{attrs:{type:"danger"},on:{click:t.handleCancelCollection}},[t._v("取消")])],1)]):t._e()])},Zt=[function(){var t=this,e=t._self._c;return e("div",[e("h1",[t._v("收藏文章")])])}],Qt={name:"viewPage",components:{},created(){this.$axios.post("/api/user/post/read",{id:this.articleId,option:"getOne"}).then((t=>{200===t.status&&(this.content=t.data.post.content,this.title=t.data.post.title,this.createTime=t.data.post.createdAt,this.updateTime=t.data.post.updatedAt,this.collectionCount=t.data.post.collection,this.viewCount=t.data.post.viewCount,this.likeCount=t.data.post.appraise,this.tags=t.data.post.tag,this.$axios.post("/api/user/postCollection/post/readOneForAuth",{authId:this.$userInfo.user.call(this).uid,postId:this.articleId}).then((t=>{200===t.status?(this.isCollection=!0,this.collectionId=t.data.id):201===t.status&&(this.isCollection=!1)})).catch((t=>{console.log(t)})))})).catch((t=>{console.log(t)}))},data(){return{articleId:this.$route.query.articleId,content:"",title:"",updateTime:"",collectionCount:0,viewCount:0,likeCount:0,tags:[],navList:[],isCollection:!1,collectionId:null,collectionEditorShow:!1,folderNameStr:""}},methods:{formatDate(t){return wt.formatDate(t)},jumpToTag(t){document.getElementById(t).scrollIntoView({behavior:"smooth"})},onEditorReady(){console.log("ready"),this.$nextTick((()=>{const t=this.$refs.mdFather.querySelector(".v-note-read-content");if(t){const e=Array.from(t.children);for(let t=0;t<e.length;t++){const s=e[t],i=["H1","H2","H3","H4"];i.includes(s.nodeName)&&(console.log("包含其中"),s.children.length>0&&(console.log(s.children[0]),console.log(s.innerText),this.navList.push({text:s.innerText,id:s.children[0].id,textSpace:s.nodeName.split("")[1]})))}}else console.log("TextMain 不存在")}))},collection_click(t){t?(this.$domStatus.setBgBlack.call(this,!0),this.collectionEditorShow=!0,this.folderNameStr="默认"):this.$axios.post("/api/user/postCollection/post/delete",{id:this.collectionId}).then((t=>{200===t.status&&(this.isCollection=!1,this.$message.success("取消收藏成功"))})).catch((()=>{this.$message.error("取消收藏失败")}))},handleCollection(){this.$axios.post("/api/user/postCollection/post/create",{authId:this.$userInfo.user.call(this).uid,postId:this.articleId,folderNameStr:this.folderNameStr}).then((t=>{200===t.status?(this.isCollection=!0,this.collectionId=t.data.resultId,this.$message.success("收藏成功"),this.$domStatus.setBgBlack.call(this,!1),this.collectionEditorShow=!1):201===t.status&&this.$message.error("没有该文件夹")})).catch((()=>{this.$message.error("收藏失败"),this.$domStatus.setBgBlack.call(this,!1),this.collectionEditorShow=!1}))},handleCancelCollection(){this.$domStatus.setBgBlack.call(this,!1),this.collectionEditorShow=!1}},mounted(){}},Xt=Qt,te=(0,u.A)(Xt,Kt,Zt,!1,null,null,null),ee=te.exports,se=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"personalCenter"}},[e("div",{staticClass:"personalCenterNav"},[e("myLeftNav",{attrs:{navData:t.navData}})],1),e("div",{staticClass:"personalCenterMain"},[e("router-view")],1)])},ie=[],ae={name:"personalCenter",components:{myLeftNav:j},data(){return{navData:[{name:"基本信息",path:"/personalCenter/baseInfo"},{name:"账号绑定",path:"/personalCenter/accountBinding"},{name:"我的收藏",path:"/personalCenter/myCollection"}]}}},oe=ae,ne=(0,u.A)(oe,se,ie,!1,null,null,null),re=ne.exports,le=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"base-info"}},[e("div",{staticClass:"top-info"},[e("div",{staticClass:"baseInfoTop"},[e("div",{staticClass:"profileContainer",on:{click:t.openFileInput}},[t._m(0),e("img",{attrs:{src:t.profileUrl}})])]),e("div",{staticClass:"top-info-right"},[e("h1",[t._v(t._s(this.userInfo.name))])])]),e("div",{staticClass:"baseInfoMiddle"},[e("h1",[t._v("基本信息")]),e("hr"),e("div",{staticClass:"baseInfoItemContainer"},[e("div",{staticClass:"baseInfoItem"},[e("span",[t._v("用户名")]),e("span",{staticClass:"infoShow"},[t._v(t._s(this.userInfo.name))])]),e("div",{staticClass:"baseInfoItem"},[e("span",[t._v("性别")]),t.editorForm._sex?e("span",{staticClass:"infoShow"},[t._v(t._s(this.userInfo.sex))]):e("el-input",{attrs:{placeholder:"请输入性别"},model:{value:t.editorForm.sex,callback:function(e){t.$set(t.editorForm,"sex",e)},expression:"editorForm.sex"}}),t.editorForm._sex?e("span",{staticClass:"eidtorBtn",on:{click:function(e){return t.editInfo("sex")}}},[e("i",{staticClass:"el-icon-edit"}),t._v("编辑")]):[t._m(1),t._m(2)]],2),e("div",{staticClass:"baseInfoItem"},[e("span",[t._v("地区")]),t.editorForm._region?e("span",{staticClass:"infoShow"},[t._v(t._s(this.userInfo.region))]):t._e(),t.editorForm._region?e("span",{staticClass:"eidtorBtn",on:{click:function(e){return t.editInfo("region")}}},[e("i",{staticClass:"el-icon-edit"}),t._v("编辑")]):t._e()]),e("div",{staticClass:"baseInfoItem"},[e("span",[t._v("生日")]),t.editorForm._birthDay?e("span",{staticClass:"infoShow"},[t._v(t._s(this.userInfo.birthDay))]):t._e(),e("span",{staticClass:"eidtorBtn",on:{click:function(e){return t.editInfo("birthDay")}}},[e("i",{staticClass:"el-icon-edit"}),t._v("编辑")])]),e("div",{staticClass:"baseInfoItem"},[e("span",[t._v("自我介绍")]),t._v(" "),e("span",{staticClass:"eidtorBtn",on:{click:function(e){return t.editInfo("selfIntroduction")}}},[e("i",{staticClass:"el-icon-edit"}),t._v("编辑")]),t.editorForm._selfIntroduction?e("div",{staticClass:"infoShow"},[t._v(t._s(this.userInfo.selfIntroduction?this.userInfo.selfIntroduction:"暂无"))]):t._e()])])]),e("input",{ref:"fileInput",staticStyle:{visibility:"hidden",position:"absolute",top:"0",left:"0",width:"0",height:"0"},attrs:{type:"file",accept:"image/*"},on:{change:t.onFileChange}}),t.showCropper?e("div",{staticClass:"avatar-cropper-container"},[e("avatar-cropper",{attrs:{image:t.imageToCrop,limitInfo:t.limitInfo},on:{cancelCropper:t.closeCropper,uploadAvatar:t.uploadAvatar}})],1):t._e()])},ce=[function(){var t=this,e=t._self._c;return e("div",[e("i",{staticClass:"el-icon-plus"})])},function(){var t=this,e=t._self._c;return e("span",{staticClass:"compeleteBtn"},[e("i",{staticClass:"el-icon-close"}),t._v("取消 ")])},function(){var t=this,e=t._self._c;return e("span",{staticClass:"compeleteBtn"},[e("i",{staticClass:"el-icon-check"}),t._v("完成 ")])}],de=(s(6573),s(8100),s(7936),s(7467),s(4732),s(9577),s(4979),function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"AvatarCropper"}},[e("h1",[t._v("上传头像")]),e("div",{staticClass:"flex-display"},[e("div",{staticClass:"cropper-container"},[e("vue-cropper",{ref:"cropper",attrs:{img:t.image,outputSize:t.option.outputSize,outputType:t.option.outputType,info:t.option.info,canScale:t.option.canScale,autoCrop:t.option.autoCrop,autoCropWidth:t.option.autoCropWidth,autoCropHeight:t.option.autoCropHeight,fixed:t.option.fixed,fixedNumber:t.option.fixedNumber,full:t.option.full,fixedBox:t.option.fixedBox,canMove:t.option.canMove,canMoveBox:t.option.canMoveBox,original:t.option.original,centerBox:t.option.centerBox,height:t.option.height,infoTrue:t.option.infoTrue,maxImgSize:t.option.maxImgSize,enlarge:t.option.enlarge,mode:t.option.mode,limitMinSize:t.option.limitMinSize},on:{realTime:t.realTime,imgLoad:t.imgLoad}})],1),e("div",{staticClass:"cropperShow"},[e("img",{attrs:{src:t.showCropper}})])]),e("div",{staticClass:"flex-display btn-Group"},[e("el-button",{attrs:{type:"primary"},on:{click:t.uploadCroppedImage}},[t._v("上传头像")]),e("el-button",{attrs:{type:"primary"},on:{click:t.cancelCropper}},[t._v("取消")])],1)])}),ue=[],he=s(419),pe={name:"AvatarCropper",components:{VueCropper:he.VueCropper},props:{image:{type:String,required:!0},limitInfo:{type:Object,required:!0}},data(){return{option:{outputSize:1,outputType:"jpeg",info:!0,canScale:!1,autoCrop:!0,autoCropWidth:400,autoCropHeight:400,limitMinSize:[null,null],fixed:!0,fixedNumber:[1,1],full:!1,fixedBox:!1,canMove:!1,canMoveBox:!0,original:!1,centerBox:!0,height:!0,infoTrue:!1,maxImgSize:400,enlarge:1,mode:"contain"},realTimer:null,showCropper:""}},methods:{realTime(){clearTimeout(this.realTimer),this.realTimer=setTimeout((()=>{this.getCroppedImage()}),200)},imgLoad(){this.limitInfo.heigh>this.limitInfo.width?(this.option.limitMinSize[0]=this.limitInfo.width/3,this.option.limitMinSize[1]=this.limitInfo.width/3):(this.option.limitMinSize[0]=this.limitInfo.height/3,this.option.limitMinSize[1]=this.limitInfo.height/3)},getCroppedImage(){this.$refs.cropper.getCropData((t=>{this.showCropper=t}))},cancelCropper(){this.$emit("cancelCropper")},uploadCroppedImage(){this.$refs.cropper.getCropData((t=>{this.$emit("uploadAvatar",t)}))}}},me=pe,ge=(0,u.A)(me,de,ue,!1,null,"6c7fde61",null),fe=ge.exports,ve={name:"baseInfo",components:{AvatarCropper:fe},computed:{...(0,l.L8)("auth",["profileUrl","user"])},data(){return{showCropper:!1,imageToCrop:"",limitInfo:{height:null,width:null},userInfo:{name:"",sex:"",region:"",birthDay:"",selfIntroduction:""},editorForm:{sex:"",_sex:!0,region:"",_region:!0,birthDay:"",_birthDay:!0,_selfIntroduction:!0,selfIntroduction:""}}},methods:{...(0,l.PY)("auth",["SET_PROFILE_URL"]),openFileInput(){this.$refs.fileInput.click()},closeCropper(){this.showCropper=!1,this.$domStatus.setBgBlack.call(this,!1)},onFileChange(t){const e=t.target.files[0];if(e){const t=new FileReader;t.onload=t=>{const e=new Image;e.src=t.target.result,e.onload=()=>{const{width:t,height:s}=e;let i=t,a=s;t<400&&s<400?(i=t,a=s,t>s?(i=400,a=s/t*400):(a=400,i=t/s*400),this.limitInfo.height=a,this.limitInfo.width=i):t>s?(this.limitInfo.width=400,this.limitInfo.height=s/t*400):(this.limitInfo.height=400,this.limitInfo.width=t/s*400);const o=document.createElement("canvas");o.width=i,o.height=a;const n=o.getContext("2d");n.drawImage(e,0,0,i,a),this.imageToCrop=o.toDataURL("image/jpeg"),this.showCropper=!0,this.$domStatus.setBgBlack.call(this,!0)}},t.readAsDataURL(e)}},uploadAvatar(t){this.showCropper=!1,this.$domStatus.setBgBlack.call(this,!1);const e=t.split(",")[1],s=atob(e),i=new Array(s.length);for(let l=0;l<s.length;l++)i[l]=s.charCodeAt(l);const a=new Uint8Array(i),o=new Blob([a],{type:"image/jpeg"}),n=new File([o],"avatar.jpg",{type:"image/jpeg"}),r=new FormData;r.append("avatar",n),r.append("authId",this.user.uid),this.$axios.post("/api/user/userInfo/updateUserProfile",r,{headers:{"Content-Type":"multipart/form-data"}}).then((t=>{console.log(t),200===t.status&&(console.log(t.data.profileUrl),this.SET_PROFILE_URL(t.data.profileUrl),this.$message.success("头像上传成功"))})).catch((t=>{console.error("头像上传失败",t)}))},editInfo(t){let e="_"+t;console.log(t,this.editorForm[t]),console.log(e,this.editorForm[e]),this.editorForm[t]="",this.editorForm[e]=!1}},created(){this.$axios.post("/api/user/userInfo/read",{option:"getOne",authId:this.user.uid}).then((t=>{this.userInfo=t.data.userInfo})).catch((t=>{console.error("获取用户信息失败",t)}))}},Ce=ve,_e=(0,u.A)(Ce,le,ce,!1,null,"1435b7ef",null),ye=_e.exports,Ie=function(){var t=this,e=t._self._c;return e("div",{staticClass:"p20 flex-display ml20",attrs:{id:"myCollection"}},[e("div",{staticClass:"collectionFolderList"},[e("div",{staticClass:"flex-display-end bluePointer"},[e("i",{staticClass:"el-icon-plus"}),e("span",{on:{click:t.oepnAddEditor}},[t._v("新建收藏夹")])]),e("el-menu",{staticClass:"mt10"},[t._l(t.myFolderList,(function(s){return[s.sonFolder?e("folderRecursion",{key:s.id,attrs:{fatherFolder:s}}):e("el-menu-item",{key:s.id,attrs:{index:s.id},nativeOn:{click:function(e){return t.handleClick(s.id)}}},[e("i",{staticClass:"el-icon-folder"}),e("span",[t._v(t._s(s.name))])])]}))],2)],1),e("div",{staticClass:"postInFolder p10"},[e("div",{staticClass:"postInFolderHeader flex-display-between"},[e("div",{staticClass:"postInFolderHeaderLeft"},[e("div",{staticClass:"font-title-3"},[t._v(t._s(t.nowShowFolderName))]),e("div",{staticClass:"mt10 p10"},[e("span",{staticClass:"font-hint"},[t._v("简介")]),e("div",{staticClass:"mt10"},[t._v(t._s(t.nowShowFolderDes))])])]),e("div",{staticClass:"postInFolderHeaderRight"},[e("el-popconfirm",{attrs:{"confirm-button-text":"确定","cancel-button-text":"取消",icon:"el-icon-warning",title:"确定要删除这条收藏夹吗？删除后，该收藏夹中的所有子文件夹和收藏都将被删除!"},on:{confirm:function(e){return t.deleteOneFolder()}}},[e("span",{staticClass:"bluePointer",attrs:{slot:"reference"},slot:"reference"},[t._v("删除收藏夹")])]),e("span",{staticClass:"bluePointer ml10"},[t._v("批量移入")])],1)]),e("div",{staticClass:"flex-display-between mt10"},[t._m(0),e("div",{staticClass:"flex-display-center"},[e("el-input",{model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}}),e("el-button",{on:{click:t.page_refresh}},[t._v("搜索")])],1)]),t.postList.length?e("div",{staticClass:"postList p10 mt10"},[t._l(t.postList,(function(s){return[e("div",{key:s.id,staticClass:"flex-display-between postItem"},[e("span",{on:{click:function(e){return t.turnToPost(s.postId)}}},[t._v(t._s(s.title))]),e("span",{on:{click:function(e){return t.handleStar(s.id)}}},[e("i",{staticClass:"el-icon-star-on"})])])]}))],2):t._e(),e("myPagination",{staticClass:"fit-content-centerBox mt10",attrs:{nowPage:t.nowPage,pageSize:t.pageSize,dataLength:t.total},on:{refresh:t.pageChange}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowAddEditor,expression:"isShowAddEditor"}],staticClass:"collectionAddEditor p20"},[e("h1",[t._v("新增文件夹")]),e("div",{staticClass:"mt10"},[e("span",[t._v("名称")]),e("el-input",{model:{value:t.addForm.name,callback:function(e){t.$set(t.addForm,"name",e)},expression:"addForm.name"}})],1),e("div",{staticClass:"mt10"},[e("span",[t._v("描述")]),e("el-input",{model:{value:t.addForm.description,callback:function(e){t.$set(t.addForm,"description",e)},expression:"addForm.description"}})],1),e("div",{staticClass:"flex-display-start mt10",staticStyle:{height:"2em","line-height":"2em",gap:"10px"}},[e("span",[t._v("新增文件夹位置")]),e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.addForm.hasFather,callback:function(e){t.$set(t.addForm,"hasFather",e)},expression:"addForm.hasFather"}},[e("el-option",{attrs:{label:"当前文件夹中",value:!0}}),e("el-option",{attrs:{label:"最外层文件夹",value:!1}})],1)],1),e("div",{staticClass:"flex-display-center mt20"},[e("el-button",{attrs:{type:"primary"},on:{click:t.handleAddFolder}},[t._v("确定")]),e("el-button",{attrs:{type:"danger"},on:{click:t.handleCancelAddFolder}},[t._v("取消")])],1)])])},we=[function(){var t=this,e=t._self._c;return e("div",[e("span",{staticClass:"bluePointer isChoose"},[t._v("文章")]),e("span",{staticClass:"bluePointer ml10"},[t._v("帖子")]),e("span",{staticClass:"bluePointer ml10"},[t._v("问答")])])}],Se=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"folderRecursion"}},[e("el-submenu",{attrs:{index:t.fatherFolder.id}},[e("template",{slot:"title"},[e("i",{staticClass:"el-icon-folder"}),e("span",{attrs:{title:t.fatherFolder.name},on:{click:function(e){return e.stopPropagation(),t.handleClick(t.fatherFolder.id)}}},[t._v(t._s(t.fatherFolder.name))])]),t._l(t.fatherFolder.sonFolder,(function(s){return[s.sonFolder?e("folderRecursion",{key:s.id,attrs:{fatherFolder:s}}):e("el-menu-item",{key:s.id,attrs:{index:s.id},nativeOn:{click:function(e){return e.stopPropagation(),t.handleClick(s.id)}}},[e("i",{staticClass:"el-icon-folder"}),e("span",[t._v(t._s(s.name))])])]}))],2)],1)},ke=[],be={name:"folderRecursion",components:{folderRecursion:$e},props:{fatherFolder:{type:Object,default:()=>{}}},methods:{...(0,l.PY)("post",["setMyCollectionId"]),handleClick(t){this.setMyCollectionId(t)}}},xe=be,Te=(0,u.A)(xe,Se,ke,!1,null,null,null),$e=Te.exports,Fe={name:"myCollection",components:{folderRecursion:$e,myPagination:st},methods:{...(0,l.PY)("post",["setMyCollectionId"]),handleClick(t){this.setMyCollectionId(t)},oepnAddEditor(){this.$domStatus.setBgBlack.call(this,!0),this.isShowAddEditor=!0},handleCancelAddFolder(){this.addForm={name:"",description:"",hasFather:!1},this.$domStatus.setBgBlack.call(this,!1),this.isShowAddEditor=!1},handleAddFolder(){"默认"!==this.addForm.name?this.$axios.post("/api/user/postCollection/create",{authId:this.$userInfo.user.call(this).uid,name:this.addForm.name,description:this.addForm.description,fatherId:this.addForm.hasFather?this.myCollectionId:null}).then((t=>{200===t.status?(this.$message.success("新建文件夹成功"),this.$domStatus.setBgBlack.call(this,!1),this.isShowAddEditor=!1,this.initFolderList()):201===t.status&&this.$message.error("文件夹已存在")})).catch((()=>{this.$message.error("新建文件夹失败")})):this.$message.error("文件夹名称不能为默认")},turnToPost(t){let e=this.$router.resolve({path:"/viewPage",query:{articleId:t}});window.open(e.href,"_blank")},handleStar(t){this.$axios.post("/api/user/postCollection/post/delete",{id:t}).then((t=>{200===t.status&&(this.$message.success("取消收藏成功"),this.page_refresh())})).catch((()=>{this.$message.error("取消收藏失败,刷新页面试试")}))},initFolderList(){this.$axios.post("/api/user/postCollection/read",{authId:this.$userInfo.user.call(this).uid}).then((t=>{this.myFolderList.splice(0,this.myFolderList.length,...t.data)}))},folder_refresh(t){this.$axios.post("/api/user/postCollection/read",{folderId:t}).then((t=>{this.nowShowFolderName=t.data.name,this.nowShowFolderDes=t.data.description}))},page_refresh(){this.$axios.post("/api/user/postCollection/post/read",{folderId:this.myCollectionId,pageSize:this.pageSize,nowPage:this.nowPage,searchValue:this.searchValue}).then((t=>{console.log(t.data),this.postList.splice(0,this.postList.length,...t.data.result),this.total=t.data.count,this.nowPage=t.data.nowPage})).catch((t=>{console.log(t)}))},pageChange(t,e){"sizeChange"===t?this.pageSize=e:this.nowPage=e,this.page_refresh()},deleteOneFolder(){this.myCollectionId!==this.defaultFolderId?this.$axios.post("/api/user/postCollection/delete",{id:this.myCollectionId,authId:this.$userInfo.user.call(this).uid}).then((t=>{200===t.status&&(this.$message.success("删除收藏夹成功"),this.initFolderList(),this.setMyCollectionId(this.defaultFolderId))})).catch((()=>{this.$message.error("删除收藏夹失败")})):this.$message.error("默认收藏夹不能删除")}},computed:{...(0,l.L8)("post",["myCollectionId"]),nowShowFolderId(){return this.myCollectionId}},watch:{nowShowFolderId(t){console.log(`我要搜索${t}文件夹中的文章`),this.folder_refresh(t),this.page_refresh()}},data(){return{myFolderList:[],postList:[],defaultFolderId:null,nowPage:1,pageSize:10,total:0,isShowAddEditor:!1,addForm:{name:"",description:"",hasFather:!1},nowShowFolderName:"",nowShowFolderDes:"",searchValue:""}},created(){this.$axios.post("/api/user/postCollection/read",{authId:this.$userInfo.user.call(this).uid}).then((t=>{this.myFolderList.push(...t.data);for(let e=0;e<this.myFolderList.length;e++)if(null===this.myFolderList[e].fatherId&&"默认"===this.myFolderList[e].name){this.nowShowFolderName=this.myFolderList[e].name,this.nowShowFolderDes=this.myFolderList[e].description,this.defaultFolderId=this.myFolderList[e].id,this.setMyCollectionId(this.myFolderList[e].id);break}})).catch((t=>{console.log(t)}))}},Ae=Fe,De=(0,u.A)(Ae,Ie,we,!1,null,"13adb051",null),Le=De.exports;i["default"].use(C.A);const Ee=[{path:"/",redirect:"/scheduleBlock/mySchedule"},{path:"/auth",name:"Auth",component:O},{path:"/scheduleBlock",name:"scheduleBlock",component:G,meta:{requiresAuth:!0},children:[{path:"mySchedule",name:"mySchedule",components:{scheduleMain:xt}},{path:"todoList",name:"todoList",components:{scheduleMain:nt}},{path:"scheduleStatistic",name:"scheduleStatistic",components:{scheduleMain:Ct}}]},{path:"/editorBlock",name:"editorBlock",component:Mt,meta:{requiresAuth:!0},children:[{path:"creationManagement",name:"creationManagement",component:Wt}]},{path:"/viewPage",name:"viewPage",query:{articleId:String},component:ee},{path:"/editorPage",name:"editorPage",component:qt,meta:{requiresAuth:!0}},{path:"/personalCenter",name:"personalCenter",component:re,meta:{requiresAuth:!0},children:[{path:"baseInfo",name:"baseInfo",component:ye},{path:"myCollection",name:"myCollection",component:Le}]}],Be=new C.A({mode:"history",base:"/",routes:Ee});Be.beforeEach(((t,e,s)=>{const i=t.matched.some((t=>t.meta.requiresAuth)),a=Dt.getters["auth/isAuthenticated"];i&&!a?s("/auth"):s()}));var Pe=Be,Oe=s(9143),Me=s.n(Oe),Ne=s(4373),ze=s(2705),Re={...(0,l.PY)("pageStatus",["setBgBlack"])},He={...(0,l.L8)("auth",["user"])};i["default"].prototype.$domStatus=Re,i["default"].prototype.$userInfo=He,i["default"].config.productionTip=!1,Ne.A.defaults.baseURL="/",Ne.A.defaults.headers.post["Content-Type"]="application/json",i["default"].component("mavonEditor",ze.mavonEditor),i["default"].use(Me()),i["default"].prototype.$axios=Ne.A,Ne.A.interceptors.request.use((t=>{const e=t.url.split("/").pop();if("login"!==e&&"register"!==e){const e=localStorage.getItem("token");e&&(t.headers["Authorization"]=`Bearer ${e}`)}return t}),(t=>Promise.reject(t))),Ne.A.interceptors.response.use((t=>t),(t=>{if(t.response&&401===t.response.status){if(console.log("token失效,请重新登录"),localStorage.removeItem("token"),Dt.commit("auth/CLEAR_AUTH"),"/auth"===Pe.currentRoute.path)return Promise.reject(t);Pe.push("/auth")}return Promise.reject(t)})),new i["default"]({render:t=>t(v),router:Pe,store:Dt}).$mount("#app")}},e={};function s(i){var a=e[i];if(void 0!==a)return a.exports;var o=e[i]={id:i,loaded:!1,exports:{}};return t[i].call(o.exports,o,o.exports,s),o.loaded=!0,o.exports}s.m=t,function(){s.amdO={}}(),function(){var t=[];s.O=function(e,i,a,o){if(!i){var n=1/0;for(d=0;d<t.length;d++){i=t[d][0],a=t[d][1],o=t[d][2];for(var r=!0,l=0;l<i.length;l++)(!1&o||n>=o)&&Object.keys(s.O).every((function(t){return s.O[t](i[l])}))?i.splice(l--,1):(r=!1,o<n&&(n=o));if(r){t.splice(d--,1);var c=a();void 0!==c&&(e=c)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[i,a,o]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={524:0};s.O.j=function(e){return 0===t[e]};var e=function(e,i){var a,o,n=i[0],r=i[1],l=i[2],c=0;if(n.some((function(e){return 0!==t[e]}))){for(a in r)s.o(r,a)&&(s.m[a]=r[a]);if(l)var d=l(s)}for(e&&e(i);c<n.length;c++)o=n[c],s.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return s.O(d)},i=self["webpackChunkmy_blog"]=self["webpackChunkmy_blog"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=s.O(void 0,[504],(function(){return s(7645)}));i=s.O(i)})();
//# sourceMappingURL=app.9fe4cf4b.js.map